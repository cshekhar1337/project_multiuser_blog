{% extends "user_blog/base.html" %}

{% block header %}
{% include "user_blog/btn_edit_logout.html" %}

{% endblock %}


{% block content %}
<div class="container">

    <section>
        Welcome back <b>{{ name }}</b>
        <br/>

    </section>
    <script type='text/javascript'>
        function likepost(value, dt, uname) {
            $.ajax({

                url: './../likepost/' + value,
                dataType: 'json',
                success: function () {
                    //alert(data.value);
                    $(dt).hide();
                    var s = '#likes_' + value;
                    $(s).append(uname);
                }
            })
        }
        function editpost(value) {
            /*
             $.ajax({
             type: "POST",
             url: './../editpost/' + value + '/',
             data: {
             'subject': getsubject(value),
             'content': getcontent(value),

             }


             })
             */
            var s = getsubject(value);
            var c = getcontent(value);
            $('#subjectmodal').val(s);
            $('#contentmodal').val(c);
            var l = './../editpost/' + value + '/';
            $('#modal_form').attr('action', l);
            $('#myModalNorm').modal("show");
        }
        function addpost() {
            var s = "";
            var c = "";
            $('#subjectmodal').val(s);
            $('#contentmodal').val(c);
            var l = './../addpost/';
            $('#modal_form').attr('action', l);
            $('#myModalNorm').modal("show");
        }
        function getsubject(value) {
            var s = '#subjectid_' + value;
            return $(s).text();

        }
        function getcontent(value) {
            var s = '#contentid_' + value;
            return $(s).text();

        }

    </script>

    <hr>


    <!-- Modal for the update pop up window. -->
    <div class="modal fade" id="myModalNorm" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        Edit your Post
                    </h4>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">

                    <form id="modal_form" role="form" method="post" action="">
                        <div class="form-group">
                            <label for="subjectmodal">Subject</label>
                            <input type="text" class="form-control"
                                   id="subjectmodal" name='subject' placeholder="Subject"/>
                        </div>
                        <div class="form-group">
                            <label for="contentmodal">Content</label>
                            <input type="text" class="form-control"
                                   id="contentmodal" name='content' placeholder="Content"/>
                        </div>
                        <button type="submit" class="btn btn-default">Submit</button>
                    </form>


                </div>


            </div>
        </div>
    </div>
    <!-- Modal end -->

    <section>

        {% for entry in res %}


        <div class="flexend">
            <div><b>Posted by </b>{{ entry.user_name }}</div>
            &nbsp;
            <div></b>Last Updated</b> {{ entry.updated_at }}</div>
            &nbsp;
        </div>
        <div style="float: none"></div>
        <div class="flexstart">
            <b>Subject:</b>
            <div id="subjectid_{{entry.blog_id}}">{{ entry.subject }}</div>
        </div>

        <div class="flexstart">
            <div><b>Content:</b>
                <div id="contentid_{{entry.blog_id}}">{{ entry.content }}</div>
            </div>
        </div>
        <div style="float: none"></div>

        {% if user_name and user_name != entry.user_name and user_name not in entry.likes%}
        <div><a href="#" onclick="likepost({{entry.blog_id}}, this , '{{user_name}}')"> Like the article</a></div>
        {% endif %}
        {% if user_name and user_name == entry.user_name %}
        <div><a href="#" onclick="editpost({{entry.blog_id}})"> Edit the article </a></div>
        {% endif %}


        <div class="flexend">
            <div id="likes_{{entry.blog_id}}"><b>Likes </b></div>
            &nbsp;
            {% for like in entry.likes %}
            <div> {{ like }}</div>
            &nbsp;

            {% endfor %}
        </div>


        <hr>


        {% endfor %}


    </section>

    <hr>

    <section>
    </section>

</div>

{% endblock %}